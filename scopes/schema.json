{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://n8n-recon-hub/schemas/scope-definition.json",
  "title": "Red Team Scope Definition",
  "description": "Authorization scope for red team reconnaissance operations",
  "type": "object",
  "required": ["scope_name", "in_scope", "authorization"],
  "properties": {
    "scope_name": {
      "type": "string",
      "description": "Unique identifier for this engagement",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "minLength": 3,
      "maxLength": 100
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of the engagement"
    },
    "in_scope": {
      "type": "array",
      "description": "List of authorized targets (domains, IPs, CIDR ranges)",
      "minItems": 1,
      "items": {
        "type": "string",
        "pattern": "^(\\*\\.)?[a-zA-Z0-9.-]+$|^([0-9]{1,3}\\.){3}[0-9]{1,3}(/[0-9]{1,2})?$"
      }
    },
    "out_of_scope": {
      "type": "array",
      "description": "Explicitly forbidden targets (even if matching in_scope)",
      "default": [],
      "items": {
        "type": "string"
      }
    },
    "authorization": {
      "type": "object",
      "required": ["authorized_by", "authorization_date"],
      "properties": {
        "authorized_by": {
          "type": "string",
          "description": "Name/email of person granting authorization",
          "minLength": 3
        },
        "authorization_date": {
          "type": "string",
          "format": "date",
          "description": "Date authorization was granted (YYYY-MM-DD)"
        },
        "expiry_date": {
          "type": "string",
          "format": "date",
          "description": "Date authorization expires (YYYY-MM-DD)"
        },
        "engagement_type": {
          "type": "string",
          "enum": ["red_team", "penetration_test", "vulnerability_assessment", "bug_bounty"],
          "description": "Type of security assessment"
        },
        "documentation_url": {
          "type": "string",
          "format": "uri",
          "description": "Link to authorization documentation"
        }
      }
    },
    "rules": {
      "type": "object",
      "description": "Technical constraints for the engagement",
      "properties": {
        "max_ports": {
          "type": "integer",
          "minimum": 1,
          "maximum": 65535,
          "default": 1000,
          "description": "Maximum number of ports to scan per host"
        },
        "allowed_tools": {
          "type": "array",
          "description": "List of authorized security tools",
          "items": {
            "type": "string",
            "enum": [
              "nmap", "naabu", "masscan",
              "subfinder", "amass", "dnsx",
              "httpx", "nuclei", "ffuf",
              "sqlmap", "testssl.sh", "gowitness",
              "katana", "gau", "waybackurls",
              "subjack", "webanalyze", "tlsx"
            ]
          }
        },
        "stealth_level": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "default": "medium",
          "description": "How stealthy the scan should be"
        },
        "max_concurrent_scans": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "default": 3,
          "description": "Maximum number of concurrent scan sessions"
        },
        "rate_limit_per_sec": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 10,
          "description": "Maximum HTTP requests per second"
        },
        "require_manual_approval": {
          "type": "boolean",
          "default": false,
          "description": "Require operator approval before starting each phase"
        },
        "allowed_hours": {
          "type": "object",
          "description": "Time windows when scanning is allowed",
          "properties": {
            "timezone": {
              "type": "string",
              "default": "UTC"
            },
            "days": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
              },
              "default": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"]
            },
            "start_time": {
              "type": "string",
              "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",
              "default": "09:00"
            },
            "end_time": {
              "type": "string",
              "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",
              "default": "17:00"
            }
          }
        }
      }
    },
    "contacts": {
      "type": "object",
      "description": "Contact information for the engagement",
      "properties": {
        "client_contact": {
          "type": "string",
          "description": "Client point of contact"
        },
        "technical_contact": {
          "type": "string",
          "description": "Technical contact for issues"
        },
        "escalation_contact": {
          "type": "string",
          "description": "Escalation contact for emergencies"
        }
      }
    },
    "notes": {
      "type": "string",
      "description": "Additional notes about the engagement"
    }
  }
}
