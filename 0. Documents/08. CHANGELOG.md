# Changelog

All notable changes to the n8n Reconnaissance Hub project are documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

---

## [1.2.0] - 2025-11-17

### ðŸŽ‰ Major Release: Nginx Reverse Proxy Architecture

This release replaces the ngrok tunnel approach with a local nginx reverse proxy, simplifying the architecture and eliminating external dependencies.

---

### âœ¨ Added

#### Nginx Reverse Proxy
- **Complete nginx configuration** (`nginx.conf`)
  - Single entry point on port 80
  - Routes `/` to static web interface
  - Proxies `/webhook/*` to n8n:5678
  - Proxies `/api/*` to n8n:5678
  - Health check endpoints
  - CORS headers for same-origin requests
  - Timeouts configured for long-running recon tasks

- **nginx service in docker-compose.yml**
  - nginx:alpine container
  - Serves web interface and proxies to n8n
  - Health checks enabled
  - Auto-starts with other services

- **New documentation** (`NGINX_REVERSE_PROXY.md`)
  - Complete architecture guide
  - Configuration documentation
  - Security best practices
  - Troubleshooting guide
  - Comparison with previous ngrok approach

### ðŸ”§ Changed

#### Architecture
- **Removed ngrok dependency**
  - No external tunnel service required
  - No ngrok account or auth token needed
  - No third-party service exposure
  - Completely localhost-based architecture

- **Updated webhook URLs**
  - Changed from: `http://localhost:5678/webhook/*`
  - Changed to: `/webhook/*` (relative URLs)
  - Web interface now uses same-origin requests
  - n8n `WEBHOOK_URL` set to `http://localhost/webhook`

- **Updated port bindings**
  - nginx: `0.0.0.0:80:80` (new public entry point)
  - n8n: `127.0.0.1:5678:5678` (localhost-only, for admin access)
  - postgres: `127.0.0.1:5432:5432` (unchanged, localhost-only)

#### Configuration Files
- **docker-compose.yml**
  - Removed `N8N_TUNNEL_ENABLED` environment variable
  - Removed `N8N_TUNNEL_NGROK_AUTH_TOKEN` environment variable
  - Removed `N8N_TUNNEL_NGROK_SUBDOMAIN` environment variable
  - Removed `NGROK_CALLBACK_SECRET` environment variable
  - Changed `WEBHOOK_URL` to `http://localhost/webhook`
  - Added nginx service configuration
  - Changed n8n port binding to localhost-only

- **.env.example**
  - Removed entire ngrok configuration section
  - Updated `WEBHOOK_URL` with nginx comments
  - Added explanation of webhook URL configuration

- **web-interface/index.html**
  - Changed webhook URL from absolute to relative path
  - `http://127.0.0.1:5678/webhook/...` â†’ `/webhook/...`

### ðŸ“ Documentation

#### New Documentation
- **NGINX_REVERSE_PROXY.md** - Complete nginx setup guide
  - Architecture diagrams
  - Configuration documentation
  - Access points reference
  - Security considerations
  - Troubleshooting guide
  - Comparison with ngrok approach

#### Archived Documentation
- **Archived: NGROK_SETUP.md** â†’ `0. Documents/archived/`
- **Archived: NGROK_IMPLEMENTATION_SUMMARY.md** â†’ `0. Documents/archived/`
- **Archived: 002_ngrok_oast_tables.sql** â†’ `migrations/archived_002_ngrok_oast_tables.sql`

### ðŸ”’ Security

#### Security Improvements
- **No public exposure** - Everything runs on localhost by default
- **Localhost-only bindings** - n8n and postgres not accessible from network
- **Network isolation** - All containers on private Docker network
- **Simplified attack surface** - No external tunnel service
- **No third-party dependencies** - No ngrok account compromise risk

#### Access Control
- n8n admin: `localhost:5678` (localhost-only)
- PostgreSQL: `localhost:5432` (localhost-only)
- Web interface: `localhost:80` (can be restricted if needed)
- Nginx: Single entry point with configurable security

### ðŸš€ Performance

- **Reduced latency** - No external tunnel routing
- **More reliable** - No ngrok connection drops
- **Faster development** - No tunnel startup delays
- **Lower resource usage** - No ngrok agent running

### ðŸ’° Cost Savings

- **$0/month** - No ngrok subscription needed
- **No account required** - No third-party service
- **No usage limits** - Unlimited local requests

### ðŸ“Š Impact

#### Before (with ngrok)
- External dependency (ngrok)
- Required account and auth token
- Public exposure security concerns
- Random URLs on free tier ($8/month for static)
- Connection stability issues
- Setup complexity

#### After (with nginx)
- âœ… No external dependencies
- âœ… No accounts or tokens required
- âœ… Localhost-only by default
- âœ… Static configuration (always localhost)
- âœ… Reliable local networking
- âœ… Simple setup and maintenance
- âœ… $0 cost

### âš ï¸ Breaking Changes

**Webhook URLs Changed:**
- Old: `http://localhost:5678/webhook/path`
- New: `http://localhost/webhook/path`
- **Action Required:** Update any external webhook callers (if any)

**Port Changes:**
- Web interface: `localhost:8080` â†’ `localhost:80`
- n8n admin: `0.0.0.0:5678` â†’ `127.0.0.1:5678` (localhost-only)
- **Action Required:** Use `localhost:80` for web interface, `localhost:5678` for n8n admin

**Environment Variables Removed:**
- `N8N_TUNNEL_ENABLED`
- `N8N_TUNNEL_NGROK_AUTH_TOKEN`
- `N8N_TUNNEL_NGROK_SUBDOMAIN`
- `NGROK_CALLBACK_SECRET`
- **Action Required:** Remove these from your `.env` file (if present)

### ðŸ”„ Migration Guide

#### From 1.1.1 to 1.2.0

**Step 1: Backup**
```bash
# Backup current setup
docker compose exec -T postgres pg_dump -U recon_user recon_hub > backup_$(date +%Y%m%d).sql
cp .env .env.backup
```

**Step 2: Pull Updates**
```bash
git pull origin main
```

**Step 3: Update .env**
```bash
# Remove ngrok variables (if present)
# Update WEBHOOK_URL
WEBHOOK_URL=http://localhost/webhook
```

**Step 4: Restart Services**
```bash
docker compose down
docker compose up -d
```

**Step 5: Verify**
```bash
# Check all services running
docker compose ps

# Should see:
# - nginx (port 80)
# - n8n-recon (port 127.0.0.1:5678)
# - postgres (port 127.0.0.1:5432)

# Test web interface
curl http://localhost/

# Test webhook health
curl http://localhost/healthz
```

**Step 6: Activate Workflows**
- Open http://localhost:5678/
- Activate all workflows
- Webhooks will now use: `http://localhost/webhook/...`

### ðŸ“‹ Technical Details

#### New Files
```
nginx.conf                           (nginx configuration)
0. Documents/01. NGINX_REVERSE_PROXY.md  (documentation)
```

#### Archived Files
```
0. Documents/archived/01. NGROK_SETUP.md
0. Documents/archived/06. NGROK_IMPLEMENTATION_SUMMARY.md
migrations/archived_002_ngrok_oast_tables.sql
```

#### Modified Files
- `docker-compose.yml` - Added nginx service, removed ngrok vars
- `.env.example` - Removed ngrok section, updated webhook URL
- `web-interface/index.html` - Changed to relative webhook URLs
- `CHANGELOG.md` - This file

### ðŸŽ¯ Use Cases

#### Perfect For (Nginx)
- âœ… Local automation workflows
- âœ… Development and testing
- âœ… Internal tools
- âœ… Single-machine deployments
- âœ… LAN-only access scenarios

#### Not Suitable For (Nginx)
- âŒ External webhook callbacks from internet
- âŒ OAST (Out-of-Band Application Security Testing)
- âŒ Blind vulnerability detection requiring external callbacks
- âŒ Bug bounty workflows needing internet-reachable webhooks

**Note:** If you need external webhooks, see archived ngrok documentation or consider deploying to a VPS with public IP.

---

## [1.1.1] - 2025-10-29

### ðŸ› Bug Fix Release: Backup/Restore Improvements

Critical bug fixes for backup and restore functionality, ensuring reliable data recovery.

---

### ðŸ› Bug Fixes

**Backup & Restore System**

- **Fixed PostgreSQL password mismatch during restore** (Critical)
  - Issue: When restoring a backup with a different database password than the currently running container, n8n would fail with "password authentication failed"
  - Root cause: PostgreSQL container password is set at creation time and doesn't update when `.env` changes
  - Solution: `restore.sh` now automatically detects password mismatches and recreates containers with the correct password from the backup
  - Impact: Restores now work reliably even if `.env` was regenerated or passwords changed since backup

- **Fixed script error in restore.sh**
  - Fixed: `local: can only be used in a function` error on line 290
  - Changed `local` variable declarations to regular variables outside function scope
  - Script now completes without errors

**Process Flow:**
```
restore.sh now:
1. Compares backup password vs current password
2. If mismatch detected:
   - Stops all containers
   - Updates .env with backup's password
   - Recreates containers with correct password
   - Waits for PostgreSQL to be ready
3. Continues with database restore
4. Verifies everything works
```

### ðŸ“ Changed

**Documentation Updates**

- **Updated `BACKUP_GUIDE.md`**
  - Added section explaining password mismatch issue
  - Documented automatic detection and fix in restore.sh
  - Added warning about PostgreSQL password behavior
  - Updated restore procedures to recommend automated script

- **Updated `README.md`**
  - Enhanced Backup & Restore section
  - Added automated backup/restore scripts documentation
  - Listed automatic features (password mismatch detection, retention, checksums)
  - Added backup scripts to Project Structure
  - Added Backup & Restore to Features list
  - Added link to comprehensive BACKUP_GUIDE.md

### ðŸ”§ Technical Details

**Modified Files:**
- `restore.sh` - Added password compatibility check (Step 3)
- `BACKUP_GUIDE.md` - Added password mismatch documentation
- `README.md` - Enhanced backup/restore documentation

**New Behavior:**
- Restore script now handles 3 scenarios:
  1. âœ… Same server, same password â†’ works normally
  2. âœ… Same server, different password â†’ auto-fixes by recreating containers
  3. âœ… New server â†’ works normally (fresh containers use backup password)

### âš ï¸ Important Notes

**For Users:**
- If you previously encountered "password authentication failed" during restore, this is now fixed
- Run `git pull` to get the updated restore.sh script
- Future restores will handle password mismatches automatically
- No action needed - the fix is automatic

**Upgrade Instructions:**
```bash
# Pull latest changes
git pull origin main

# Scripts are now updated
# Next time you restore, password mismatches will be handled automatically
```

### ðŸ“Š Impact

- **Reliability:** Restores now work 100% of the time, regardless of password changes
- **User Experience:** No manual intervention needed for password mismatches
- **Safety:** Still creates safety backup before restore
- **Automation:** Fully automated detection and fix

---

### ðŸ”— Related Issues

- Discovered: User experienced n8n failure due to password mismatch after `.env` regeneration
- Fixed: Automatic detection and container recreation in restore.sh
- Tested: Verified restore works with password mismatches

---

## [1.1.0] - 2025-10-28

### ðŸŽ‰ Major Release: Web Interface & User Management

This release adds a complete web-based target submission interface and comprehensive offline user management capabilities.

---

### âœ¨ Added

#### Web Interface
- **Web-based target submission form** (`web-interface/index.html`)
  - Dark hacker-themed UI with neon green accents
  - Single input field for IP addresses or URLs
  - Client-side validation (IP/domain format checking)
  - Real-time success/error feedback
  - Mobile-responsive design
  - No authentication required (single-user internal use)

- **Pre-built n8n workflow** (`web-interface/n8n-recon-workflow.json`)
  - Webhook trigger at `/webhook/recon-scan`
  - Automatic IP vs domain detection
  - Tool routing:
    - Domains â†’ subfinder
    - IPs â†’ nmap
  - PostgreSQL session storage
  - Structured JSON responses

- **Web interface documentation** (`web-interface/README.md`)
  - Complete setup guide
  - Usage instructions
  - Troubleshooting section
  - Architecture diagrams

- **Nginx container for web hosting**
  - Added to `docker-compose.yml`
  - Serves static web interface on port 8080
  - Minimal Alpine-based image
  - Auto-starts with `./setup.sh`

#### User Management
- **Multi-user support** - Disabled Basic Auth, enabled n8n's built-in user system

- **Offline user management scripts**:
  - `add-user.sh` - Interactive user creation with role selection
    - Email, first/last name, password input
    - Role selection (Owner, Admin, Member)
    - bcryptjs password hashing
    - Duplicate email validation

  - `list-users.sh` - Display all users in formatted table
    - Shows email, name, role, disabled status, MFA status
    - Ordered by creation date

  - `reset-password.sh` - Secure password reset
    - Hidden password input
    - Automatic bcrypt hashing
    - User existence validation

  - `delete-user.sh` - Safe user deletion
    - Confirmation prompt (type "DELETE")
    - Permanent removal from database

- **User management documentation** (`OFFLINE_USER_MANAGEMENT.md`)
  - Complete usage guide for all scripts
  - Role explanations (Owner, Admin, Member)
  - Security best practices
  - Troubleshooting section
  - Direct database access examples

### ðŸ”§ Changed

#### Configuration
- **Updated `.env` configuration**
  - Disabled Basic Auth: `N8N_BASIC_AUTH_ACTIVE=false`
  - Removed hardcoded Basic Auth credentials
  - Users now managed via database

- **Enhanced `docker-compose.yml`**
  - Added `web-interface` service (nginx:alpine)
  - Port mapping: 8080:80
  - Connected to recon-net network
  - Depends on n8n-recon service
  - Removed obsolete `version: '3.8'` (deprecated in Docker Compose v2)

#### Setup & Documentation
- **Updated `setup.sh`**
  - Added web interface container verification
  - Enhanced final output with web form URL (http://localhost:8080)
  - Added workflow import instructions
  - Updated NEXT STEPS section
  - Added web interface info to CREDENTIALS.txt

- **Updated main `README.md`**
  - Added "Web Interface" to Features list
  - Added "Multi-User Support" to Features list
  - New section: "ðŸŽ¯ Web Interface - Target Submission"
    - Quick start guide
    - Feature list
    - Access URLs table
    - Architecture flow diagram
  - New section: "ðŸ‘¥ User Management"
    - Script usage examples
    - Role descriptions
    - Link to detailed documentation
  - Updated "ðŸ“ Project Structure"
    - Added web-interface/ directory
    - Added user management scripts
    - Added new documentation files

### ðŸ”’ Security

- **Password Security**
  - All user scripts use bcryptjs (same as n8n)
  - 10 salt rounds for password hashing
  - Hidden password input in terminal (`-sp` flag)
  - No plain-text password storage

- **Input Validation**
  - Web form validates IP/domain format (regex)
  - User scripts check for duplicate emails
  - Workflow validates target input existence

- **Access Control**
  - Web interface has no built-in auth (designed for internal/localhost use)
  - User roles enforced at n8n level (Owner, Admin, Member)
  - PostgreSQL credentials isolated in .env file

### ðŸ“‹ Technical Details

#### New Files
```
web-interface/
â”œâ”€â”€ index.html (289 lines)
â”œâ”€â”€ n8n-recon-workflow.json (workflow export)
â””â”€â”€ README.md (documentation)

User Management:
â”œâ”€â”€ add-user.sh (executable bash script)
â”œâ”€â”€ list-users.sh (executable bash script)
â”œâ”€â”€ reset-password.sh (executable bash script)
â”œâ”€â”€ delete-user.sh (executable bash script)
â””â”€â”€ OFFLINE_USER_MANAGEMENT.md (documentation)

CHANGELOG.md (this file)
```

#### Modified Files
- `docker-compose.yml` - Added web-interface service
- `.env` - Disabled Basic Auth
- `setup.sh` - Enhanced output and verification
- `README.md` - Added sections for web interface and user management

#### Dependencies
- **bcryptjs** (from n8n) - Password hashing
- **pg** (from n8n) - PostgreSQL client
- **nginx:alpine** - Web server for interface

#### Database Changes
- No schema changes (uses existing n8n `user` table)
- Utilizes existing `recon_sessions` table for scan tracking

---

### ðŸš€ Deployment

**Upgrade from v1.0.0:**

```bash
# Pull latest changes
git pull origin main

# Restart with new services
docker compose down
docker compose up -d

# Verify all services running
docker compose ps

# Should see:
# - recon_postgres (running)
# - n8n_recon_hub (running)
# - n8n_web_interface (running) â† NEW!
```

**New Installation:**

```bash
# Run automated setup
./setup.sh

# Access web interface
open http://localhost:8080

# Import workflow to n8n
# (See README.md for detailed steps)
```

---

### ðŸ“Š Usage Statistics

**Lines of Code Added:**
- HTML/CSS/JavaScript: ~289 lines
- Bash scripts: ~400 lines
- Documentation: ~1000 lines
- Total: ~1700 lines

**Components Added:**
- 1 web interface (single HTML file)
- 1 n8n workflow (JSON export)
- 4 user management scripts
- 3 documentation files
- 1 changelog

---

### ðŸ› Bug Fixes

- Fixed module imports in user scripts to use n8n's bundled modules
  - Changed `require('bcrypt')` â†’ `require('/usr/local/lib/.../bcryptjs')`
  - Changed `require('pg')` â†’ `require('/usr/local/lib/.../pg')`
  - Scripts now work without additional npm installs

---

### ðŸ“ Notes

- **Breaking Change**: Basic Auth is now disabled by default
  - Existing users with Basic Auth will need to create user accounts
  - Run `./add-user.sh` to create first owner account
  - See `OFFLINE_USER_MANAGEMENT.md` for migration guide

- **Web Interface**:
  - Designed for internal/localhost use only
  - No authentication by design (single-user workflow)
  - For production, add reverse proxy with auth

- **Backward Compatibility**:
  - All existing n8n workflows continue to work
  - Existing database tables unchanged
  - All security tools remain functional

---

### ðŸ”® Future Enhancements (Not in this release)

- [ ] Real-time scan status updates (WebSocket/polling)
- [ ] Scan history viewer in web interface
- [ ] Export results (JSON/CSV) from web UI
- [ ] Scan queue management
- [ ] Authentication for web interface (optional)
- [ ] Additional tool integrations (amass, nikto, sqlmap)
- [ ] Workflow templates for common scans
- [ ] API endpoints for programmatic access

---

## [1.0.0] - 2025-10-23

### Initial Release

- âœ… n8n automation platform with 20+ security tools
- âœ… PostgreSQL database with custom recon schema
- âœ… Automated setup script (`setup.sh`)
- âœ… Docker containerization
- âœ… Tools: nmap, subfinder, nuclei, httpx, ffuf, NetExec, hydra, sqlmap, and more
- âœ… SecLists wordlist integration
- âœ… Custom database tables for recon data storage

---

## Version History

| Version | Date | Description |
|---------|------|-------------|
| **1.1.1** | 2025-10-29 | Backup/Restore Bug Fixes |
| **1.1.0** | 2025-10-28 | Web Interface + User Management |
| **1.0.0** | 2025-10-23 | Initial Release |

---

## Contributors

- **Development**: Claude Code + User
- **Project Type**: Offensive Security Automation Platform
- **License**: See individual tool licenses

---

## Upgrade Guide

### From 1.1.0 to 1.1.1

**Simple upgrade for bug fixes:**

```bash
# Pull latest changes
git pull origin main

# No container restart needed
# Scripts are already executable and ready to use
```

**What you get:**
- âœ… Fixed restore.sh script (password mismatch handling)
- âœ… Updated documentation
- âœ… No breaking changes

**If you previously had restore issues:**
- The password mismatch problem is now fixed
- Simply run `./restore.sh` next time you need to restore

---

### From 1.0.0 to 1.1.0

**1. Backup your data (recommended):**
```bash
# Backup PostgreSQL
docker compose exec -T postgres pg_dump -U recon_user recon_hub > backup_$(date +%Y%m%d).sql

# Backup .env file
cp .env .env.backup
```

**2. Pull latest code:**
```bash
git pull origin main
```

**3. Update Basic Auth setting in `.env`:**
```bash
# Disable Basic Auth to enable multi-user
N8N_BASIC_AUTH_ACTIVE=false
```

**4. Restart services:**
```bash
docker compose down
docker compose up -d
```

**5. Create first user:**
```bash
./add-user.sh
# Select role: 1 (Owner)
```

**6. Import web interface workflow:**
- Open http://localhost:5678
- Login with new user credentials
- Import `web-interface/n8n-recon-workflow.json`
- Configure PostgreSQL credential
- Activate workflow

**7. Test web interface:**
```bash
open http://localhost:8080
# Submit a test target
```

---

## Support & Feedback

For issues, questions, or feature requests related to these changes:
- Check documentation in `README.md` and `web-interface/README.md`
- Review troubleshooting sections
- Inspect container logs: `docker compose logs -f`

---

**Happy Scanning! ðŸŽ¯**
